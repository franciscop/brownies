(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):factory(global.brownies={})})(this,function(exports){"use strict";var options=Symbol("options");var cookies$1=function(data,opt){function defaults(obj,defs){obj=obj||{};for(var key in defs){if(obj[key]===undefined){obj[key]=defs[key]}}return obj}defaults(cookies$1,{expires:365*24*3600,path:"/",secure:window.location.protocol==="https:",nulltoremove:true,autojson:true,autoencode:true,encode:function(val){return encodeURIComponent(val)},decode:function(val){return decodeURIComponent(val)},fallback:false});opt=defaults(opt,cookies$1);function expires(time){var expires=time;if(!(expires instanceof Date)){expires=new Date;expires.setTime(expires.getTime()+time*1e3)}return expires.toUTCString()}if(typeof data==="string"){var value=document.cookie.split(/;\s*/).map(opt.autoencode?opt.decode:function(d){return d}).map(function(part){return part.split("=")}).reduce(function(parts,part){parts[part[0]]=part.splice(1).join("=");return parts},{})[data];if(!opt.autojson)return value;var real;try{real=JSON.parse(value)}catch(e){real=value}if(typeof real==="undefined"&&opt.fallback)real=opt.fallback(data,opt);return real}for(var key in data){var val=data[key];var expired=typeof val==="undefined"||opt.nulltoremove&&val===null;var str=opt.autojson?JSON.stringify(val):val;var encoded=opt.autoencode?opt.encode(str):str;if(expired)encoded="";var res=opt.encode(key)+"="+encoded+(opt.expires?";expires="+expires(expired?-1e4:opt.expires):"")+";path="+opt.path+(opt.domain?";domain="+opt.domain:"")+(opt.secure?";secure":"");if(opt.test)opt.test(res);document.cookie=res}return cookies$1};var subscriptions=[];const get=(target,key)=>{if(key===Symbol.iterator)return getIterator();if(key===options)return cookies$1;const value=cookies$1(key);return typeof value==="undefined"?null:value};const set=(target,key,value=null)=>{if(key===options){for(let key in value){cookies$1[key]=value[key];return true}}cookies$1({[key]:value});subscriptions.filter(sub=>sub.key===key).forEach(({check:check})=>check());return true};const getAll=()=>{const pairs=document.cookie.split(";");const cookies={};for(var i=0;i<pairs.length;i++){const pair=pairs[i].split("=");const key=(pair[0]+"").trim();try{cookies[key]=get({},key)}catch(error){console.warn(error)}}return cookies};const getIterator=()=>{const all=Object.values(getAll());return function*(){while(all.length)yield all.shift()}};const getOwnPropertyDescriptor=()=>({enumerable:true,configurable:true});const ownKeys=()=>Object.keys(getAll());const traps={get:get,set:set,deleteProperty:set,getOwnPropertyDescriptor:getOwnPropertyDescriptor,ownKeys:ownKeys};var cookies=new Proxy({},traps);const f=String.fromCharCode;function _hasOwn(ob,key){return Object.prototype.hasOwnProperty.call(ob,key)}function _updateContext(context,bitsPerChar,getCharFromInt){if(_hasOwn(context.context_dictionaryToCreate,context.context_w)){if(context.context_w.charCodeAt(0)<256){for(let i=0;i<context.context_numBits;i++){context.context_data_val=context.context_data_val<<1;if(context.context_data_position==bitsPerChar-1){context.context_data_position=0;context.context_data.push(getCharFromInt(context.context_data_val));context.context_data_val=0}else{context.context_data_position++}}context.value=context.context_w.charCodeAt(0);for(let i=0;i<8;i++){context.context_data_val=context.context_data_val<<1|context.value&1;if(context.context_data_position==bitsPerChar-1){context.context_data_position=0;context.context_data.push(getCharFromInt(context.context_data_val));context.context_data_val=0}else{context.context_data_position++}context.value=context.value>>1}}else{context.value=1;for(let i=0;i<context.context_numBits;i++){context.context_data_val=context.context_data_val<<1|context.value;if(context.context_data_position==bitsPerChar-1){context.context_data_position=0;context.context_data.push(getCharFromInt(context.context_data_val));context.context_data_val=0}else{context.context_data_position++}context.value=0}context.value=context.context_w.charCodeAt(0);for(let i=0;i<16;i++){context.context_data_val=context.context_data_val<<1|context.value&1;if(context.context_data_position==bitsPerChar-1){context.context_data_position=0;context.context_data.push(getCharFromInt(context.context_data_val));context.context_data_val=0}else{context.context_data_position++}context.value=context.value>>1}}context.context_enlargeIn--;if(context.context_enlargeIn==0){context.context_enlargeIn=Math.pow(2,context.context_numBits);context.context_numBits++}delete context.context_dictionaryToCreate[context.context_w]}else{context.value=context.context_dictionary[context.context_w];for(let i=0;i<context.context_numBits;i++){context.context_data_val=context.context_data_val<<1|context.value&1;if(context.context_data_position==bitsPerChar-1){context.context_data_position=0;context.context_data.push(getCharFromInt(context.context_data_val));context.context_data_val=0}else{context.context_data_position++}context.value=context.value>>1}}context.context_enlargeIn--;if(context.context_enlargeIn==0){context.context_enlargeIn=Math.pow(2,context.context_numBits);context.context_numBits++}}function compress(uncompressed="",bitsPerChar,getCharFromInt){if(uncompressed===null){return""}const context={context_dictionary:{},context_dictionaryToCreate:{},context_data:[],context_c:"",context_wc:"",context_w:"",context_enlargeIn:2,context_dictSize:3,context_numBits:2,context_data_val:0,context_data_position:0};let i=0;for(let ii=0;ii<uncompressed.length;ii+=1){context.context_c=uncompressed.charAt(ii);if(!_hasOwn(context.context_dictionary,context.context_c)){context.context_dictionary[context.context_c]=context.context_dictSize++;context.context_dictionaryToCreate[context.context_c]=true}context.context_wc=context.context_w+context.context_c;if(_hasOwn(context.context_dictionary,context.context_wc)){context.context_w=context.context_wc}else{_updateContext(context,bitsPerChar,getCharFromInt);context.context_dictionary[context.context_wc]=context.context_dictSize++;context.context_w=String(context.context_c)}}if(context.context_w!==""){_updateContext(context,bitsPerChar,getCharFromInt)}context.value=2;for(i=0;i<context.context_numBits;i++){context.context_data_val=context.context_data_val<<1|context.value&1;if(context.context_data_position==bitsPerChar-1){context.context_data_position=0;context.context_data.push(getCharFromInt(context.context_data_val));context.context_data_val=0}else{context.context_data_position++}context.value=context.value>>1}while(true){context.context_data_val=context.context_data_val<<1;if(context.context_data_position==bitsPerChar-1){context.context_data.push(getCharFromInt(context.context_data_val));break}else context.context_data_position++}return context.context_data.join("")}function compressImpl(uncompressed=""){if(uncompressed===null){return""}return compress(uncompressed,16,a=>f(a))}function decompress(length,resetValue,getNextValue){const dictionary=[];const data={val:getNextValue(0),position:resetValue,index:1};const result=[];let next;let enlargeIn=4;let dictSize=4;let numBits=3;let entry="";let w;let resb;let c;for(let i=0;i<3;i+=1){dictionary[i]=i}let bits=0;let maxpower=Math.pow(2,2);let power=1;while(power!==maxpower){resb=data.val&data.position;data.position>>=1;if(data.position===0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}next=bits;switch(next){case 0:bits=0;maxpower=Math.pow(2,8);power=1;while(power!==maxpower){resb=data.val&data.position;data.position>>=1;if(data.position===0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}c=f(bits);break;case 1:bits=0;maxpower=Math.pow(2,16);power=1;while(power!==maxpower){resb=data.val&data.position;data.position>>=1;if(data.position===0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}c=f(bits);break;case 2:return""}dictionary[3]=c;w=c;result.push(c);while(true){if(data.index>length){return""}bits=0;maxpower=Math.pow(2,numBits);power=1;while(power!==maxpower){resb=data.val&data.position;data.position>>=1;if(data.position===0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}switch(c=bits){case 0:bits=0;maxpower=Math.pow(2,8);power=1;while(power!==maxpower){resb=data.val&data.position;data.position>>=1;if(data.position===0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}dictionary[dictSize++]=f(bits);c=dictSize-1;enlargeIn--;break;case 1:bits=0;maxpower=Math.pow(2,16);power=1;while(power!==maxpower){resb=data.val&data.position;data.position>>=1;if(data.position===0){data.position=resetValue;data.val=getNextValue(data.index++)}bits|=(resb>0?1:0)*power;power<<=1}dictionary[dictSize++]=f(bits);c=dictSize-1;enlargeIn--;break;case 2:return result.join("")}if(enlargeIn===0){enlargeIn=Math.pow(2,numBits);numBits++}if(dictionary[c]){entry=dictionary[c]}else{if(c===dictSize){entry=w+w.charAt(0)}else{return null}}result.push(entry);dictionary[dictSize++]=w+entry.charAt(0);enlargeIn--;w=entry;if(enlargeIn===0){enlargeIn=Math.pow(2,numBits);numBits++}}}function decompressImpl(compressed=""){if(compressed===null){return""}if(compressed===""){return null}return decompress(compressed,32768,index=>compressed.charCodeAt(index))}const baseReverseDic={};function getBaseValue(alphabet,character){if(!baseReverseDic[alphabet]){baseReverseDic[alphabet]={};for(let i=0;i<alphabet.length;i++){baseReverseDic[alphabet][alphabet.charAt(i)]=i}}return baseReverseDic[alphabet][character]}const keyStrBase64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function toBase64(input=""){if(input===null){return""}let res=compress(input,6,a=>keyStrBase64.charAt(a));switch(res.length%3){default:case 0:return res;case 1:return`${res}==`;case 2:return`${res}=`}}function fromBase64(input=""){if(input===null){return""}if(input===""){return null}return decompress(input.length,32,index=>getBaseValue(keyStrBase64,input.charAt(index)))}function toUTF16(input=""){if(input===null){return""}return compress(input,15,a=>f(a+32))+" "}function fromUTF16(compressed=""){if(compress===null){return""}if(compress===""){return null}return decompress(compressed.length,16384,index=>compressed.charCodeAt(index)-32)}function toUint8Array(uncompressed){const compressed=compressImpl(uncompressed);const buf=new Uint16Array(compressed.length*2);for(let i=0,TotalLen=compressed.length;i<TotalLen;i++){var current_value=compressed.charCodeAt(i);buf[i*2]=current_value>>>8;buf[i*2+1]=current_value%256}return buf}function fromUint8Array(compressed){if(compressed==null){return decompressImpl(compressed)}const buf=new Array(compressed.length/2);for(let i=0,TotalLen=buf.length;i<TotalLen;i++){buf[i]=compressed[i*2]*256+compressed[i*2+1]}const result=[];buf.forEach(function(c){result.push(f(c))});return decompressImpl(result.join(""))}const keyStrUriSafe="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$";function toEncodedURIComponent(input=""){if(input===null){return""}return compress(input,6,a=>keyStrUriSafe.charAt(a))}function fromEncodedURIComponent(input=""){if(input===null){return""}if(input===""){return null}input=input.replace(/\s/g,"+");return decompress(input.length,32,index=>getBaseValue(keyStrUriSafe,input.charAt(index)))}const LZString={compressToBase64:toBase64,decompressFromBase64:fromBase64,compressToUTF16:toUTF16,decompressFromUTF16:fromUTF16,compressToEncodedURIComponent:toEncodedURIComponent,decompressFromEncodedURIComponent:fromEncodedURIComponent,compressToUint8Array:toUint8Array,decompressFromUint8Array:fromUint8Array,compress:compressImpl,decompress:decompressImpl};var stringify=(obj,opts)=>{if(!opts)opts={};if(typeof opts==="function")opts={cmp:opts};var space=opts.space||"";if(typeof space==="number")space=Array(space+1).join(" ");var cycles=typeof opts.cycles==="boolean"?opts.cycles:false;var replacer=opts.replacer||function(key,value){return value};var cmp=opts.cmp&&function(f){return function(node){return function(a,b){var aobj={key:a,value:node[a]};var bobj={key:b,value:node[b]};return f(aobj,bobj)}}}(opts.cmp);var seen=[];return function stringify(parent,key,node,level){var indent=space?"\n"+new Array(level+1).join(space):"";var colonSeparator=space?": ":":";if(node&&node.toJSON&&typeof node.toJSON==="function"){node=node.toJSON()}node=replacer.call(parent,key,node);if(node===undefined){return}if(typeof node!=="object"||node===null){return JSON.stringify(node)}if(isArray(node)){var out=[];for(var i=0;i<node.length;i++){var item=stringify(node,i,node[i],level+1)||JSON.stringify(null);out.push(indent+space+item)}return"["+out.join(",")+indent+"]"}else{if(seen.indexOf(node)!==-1){if(cycles)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}else seen.push(node);var keys=objectKeys(node).sort(cmp&&cmp(node));var out=[];for(var i=0;i<keys.length;i++){var key=keys[i];var value=stringify(node,key,node[key],level+1);if(!value)continue;var keyValue=JSON.stringify(key)+colonSeparator+value;out.push(indent+space+keyValue)}seen.splice(seen.indexOf(node),1);return"{"+out.join(",")+indent+"}"}}({"":obj},"",obj,0)};var isArray=Array.isArray||function(x){return{}.toString.call(x)==="[object Array]"};var objectKeys=Object.keys||function(obj){var has=Object.prototype.hasOwnProperty||function(){return true};var keys=[];for(var key in obj){if(has.call(obj,key))keys.push(key)}return keys};const js="JSSTR:";const lz="LZSTR:";const pack=str=>{if(typeof str!=="string"){str=js+stringify(str)}if(str.length<100*1e3){str=lz+LZString.compressToUTF16(str)}return str};const unpack=str=>{try{if(str.slice(0,lz.length)===lz){str=LZString.decompressFromUTF16(str.slice(lz.length))}if(str.slice(0,js.length)===js){str=JSON.parse(str.slice(js.length))}return str}catch(e){return str}};const getAll$1=()=>{const all={};for(var key in localStorage){if(local[key]!==null){all[key]=local[key]}}return all};const local=new Proxy({},{get:(target,key)=>{if(key===Symbol.iterator){const all=Object.values(getAll$1());return function*(){while(all.length)yield all.shift()}}return unpack(localStorage.getItem(key))},set:(target,key,value)=>{localStorage.setItem(key,pack(value));subscriptions.filter(sub=>sub.key===key).forEach(({check:check})=>check());return true},deleteProperty:(target,key)=>{localStorage.removeItem(key);subscriptions.filter(sub=>sub.key===key).forEach(({check:check})=>check());return true},getOwnPropertyDescriptor(k){return{enumerable:true,configurable:true}},ownKeys(target){return Object.keys(getAll$1())}});const getAll$2=()=>{const all={};for(var key in sessionStorage){if(local$2[key]!==null){all[key]=local$2[key]}}return all};const local$2=new Proxy({},{get:(target,key)=>{if(key===Symbol.iterator){const all=Object.values(getAll$2());return function*(){while(all.length)yield all.shift()}}return unpack(sessionStorage.getItem(key))},set:(target,key,value)=>{sessionStorage.setItem(key,pack(value));subscriptions.filter(sub=>sub.key===key).forEach(({check:check})=>check());return true},deleteProperty:(target,key)=>{sessionStorage.removeItem(key);subscriptions.filter(sub=>sub.key===key).forEach(({check:check})=>check());return true},getOwnPropertyDescriptor(k){return{enumerable:true,configurable:true}},ownKeys(target){return Object.keys(getAll$2())}});const isBasic=value=>!value||["boolean","number","string"].includes(typeof value);const clone=value=>{if(isBasic(value))return value;return JSON.parse(stringify(value))};var subscribe=(obj,key,cb)=>{let prev=clone(obj[key]);const check=()=>{if(stringify(prev)===stringify(obj[key]))return;cb(obj[key],prev);prev=clone(obj[key])};const id=setInterval(check,100);subscriptions.push({id:id,key:key,check:check,cb:cb});return id};var unsubscribe=id=>{if(typeof id==="number"){return clearInterval(id)}return subscriptions.filter(({cb:cb})=>cb===id).map(sub=>clearInterval(sub.id))};exports.cookies=cookies;exports.local=local;exports.session=local$2;exports.options=options;exports.subscribe=subscribe;exports.unsubscribe=unsubscribe;Object.defineProperty(exports,"__esModule",{value:true})});